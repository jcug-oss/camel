[[json-jackson-dataformat]]
== JSon Jackson DataFormat

*Camel version 2.0 から利用可能*

Jackson は https://github.com/FasterXML/jackson-core[Jackson Library] を使用したデータフォーマットである。

[source,java]
-------------------------------
from("activemq:My.Queue").
  marshal().json(JsonLibrary.Jackson).
  to("mqseries:Another.Queue");
-------------------------------

=== Jackson オプション



// dataformat options: START
JSon Jackson データフォーマットは、以下に示した 19 個のオプションをサポートする:



[width="100%",cols="2s,1m,1m,6",options="header"]
|===
| 名前 | デフォルト値 | Java の型 | 説明
| objectMapper |  | String | Jackson を使用する際に得られた既存の ObjectMapper の ID を検索して使用する。
| useDefaultObjectMapper | true | Boolean | レジストリからデフォルトの Jackson ObjectMapper を検索して使用するか否かを指定する。
| prettyPrint | false | Boolean | 読みやすく整列された出力にするか否かを指定する。デフォルトでは false である。
| library | Jackson | JsonLibrary | どの JSON ライブラリを使用するかを指定する。
| unmarshalTypeName |  | String | アンマーシャリングの場合に使用する Java の型名称を指定する。
| jsonView |  | Class | POJO から JSON にマーシャリングする場合に、JSON 出力から特定のフィールドを除外したい場合がある。これを実現するために、Jackson の JSON ビューを使用できる。このオプションは、JsonView アノテーションを持つクラスを参照する。
| include |  | String | いくつかの NULL 値をもつ POJO から JSON にマーシャリングする場合に、それらの NULL 値をスキップするには、このオプションを NON_NULL に設定する。
| allowJmsType | false | Boolean | JMS ユーザが、 JMS 仕様からの JMSType ヘッダがアンマーシャルする場合に使用される FQN クラス名を指定するために指定することを許可するために指定される。 
Used for JMS users to allow the JMSType header from the JMS spec to specify a FQN classname to use to unmarshal to.
| collectionTypeName |  | String | レジストリ内を検索するために使用するカスタムのコレクションタイプを参照する。このオプションはほとんど使用されないが、デフォルトの java.util.Collection とは異なるコレクションタイプを使用できる。
| useList | false | Boolean | マップのリストまたは POJO のリストにアンマーシャルするかを指定する。
| enableJaxbAnnotationModule | false | Boolean | Jackson を使用している場合に、JAXB アノテーションモジュールを有効にするか否かを指定する。有効な場合に JAXB アノテーションは Jackson で使用される。
| moduleClassNames |  | String | To use custom Jackson modules com.fasterxml.jackson.databind.Module specified as a String with FQN class names. Multiple classes can be separated by comma.
| moduleRefs |  | String | To use custom Jackson modules referred from the Camel registry. Multiple modules can be separated by comma.
| enableFeatures |  | String | Set of features to enable on the Jackson com.fasterxml.jackson.databind.ObjectMapper. The features should be a name that matches a enum from com.fasterxml.jackson.databind.SerializationFeature, com.fasterxml.jackson.databind.DeserializationFeature, or com.fasterxml.jackson.databind.MapperFeature Multiple features can be separated by comma
| disableFeatures |  | String | Set of features to disable on the Jackson com.fasterxml.jackson.databind.ObjectMapper. The features should be a name that matches a enum from com.fasterxml.jackson.databind.SerializationFeature, com.fasterxml.jackson.databind.DeserializationFeature, or com.fasterxml.jackson.databind.MapperFeature Multiple features can be separated by comma
| permissions |  | String | xml もしくは json から Java Bean にアンマーシャルする際に、XStream が 使用することを許可された Java パッケージとクラスのうち、どれが制御するのかのパーミッションを追加する。
Adds permissions that controls which Java packages and classes XStream is allowed to use during unmarshal from xml/json to Java beans. A permission must be configured either here or globally using a JVM system property. The permission can be specified in a syntax where a plus sign is allow, and minus sign is deny. Wildcards is supported by using . as prefix. For example to allow com.foo and all subpackages then specfy com.foo.. Multiple permissions can be configured separated by comma, such as com.foo.,-com.foo.bar.MySecretBean. The following default permission is always included: -,java.lang.,java.util. unless its overridden by specifying a JVM system property with they key org.apache.camel.xstream.permissions.
| allowUnmarshallType | false | Boolean | If enabled then Jackson is allowed to attempt to use the CamelJacksonUnmarshalType header during the unmarshalling. This should only be enabled when desired to be used.
| timezone |  | String | マーシャリングもしくはアンマーシャリングのときに、Jackson が使用する Timezone を指定する。このオプションは、gson、fastjson、や xstream といった他の Json データフォーマットには影響は及ぼさない。
If set then Jackson will use the Timezone when marshalling/unmarshalling. This option will have no effect on the others Json DataFormat, like gson, fastjson and xstream.
| contentTypeHeader | false | Boolean | データフォーマットが、Content-Type ヘッダを設定できる場合に、Content-Type ヘッダを設定するか否かを指定する。たとえば XML へのマーシャリング時に application/xml を設定したり、JSON へのマーシャリング時に application/json を設定する。
Whether the data format should set the Content-Type header with the type from the data format if the data format is capable of doing so. For example application/xml for data formats marshalling to XML, or application/json for data formats marshalling to JSon etc.
|===
// dataformat options: END
// spring-boot-auto-configure options: START
=== Spring Boot の Auto-Configuration

Spring Boot を使用する場合は、自動設定を有効にするために、次の Maven 依存性を使用する:

[source,xml]
----
<dependency>
  <groupId>org.apache.camel</groupId>
  <artifactId>camel-jackson-starter</artifactId>
  <version>x.x.x</version>
  <!-- Camel コアバージョンと同じバージョンを使うこと。 -->
</dependency>
----


コンポーネントは、以下に示した 20 個のオプションをサポートする。



[width="100%",cols="2,5,^1,2",options="header"]
|===
| 名前 | 説明 | デフォルト値 | 型
| *camel.dataformat.json-jackson.allow-jms-type* | Used for JMS users to allow the JMSType header from the JMS spec to specify a FQN classname to use to unmarshal to. | false | Boolean
| *camel.dataformat.json-jackson.allow-unmarshall-type* | If enabled then Jackson is allowed to attempt to use the CamelJacksonUnmarshalType header during the unmarshalling. This should only be enabled when desired to be used. | false | Boolean
| *camel.dataformat.json-jackson.collection-type-name* | Refers to a custom collection type to lookup in the registry to use. This option should rarely be used, but allows to use different collection types than java.util.Collection based as default. |  | String
| *camel.dataformat.json-jackson.content-type-header* | Whether the data format should set the Content-Type header with the type from the data format if the data format is capable of doing so. For example application/xml for data formats marshalling to XML, or application/json for data formats marshalling to JSon etc. | false | Boolean
| *camel.dataformat.json-jackson.disable-features* | Set of features to disable on the Jackson com.fasterxml.jackson.databind.ObjectMapper. The features should be a name that matches a enum from com.fasterxml.jackson.databind.SerializationFeature, com.fasterxml.jackson.databind.DeserializationFeature, or com.fasterxml.jackson.databind.MapperFeature Multiple features can be separated by comma |  | String
| *camel.dataformat.json-jackson.enable-features* | Set of features to enable on the Jackson com.fasterxml.jackson.databind.ObjectMapper. The features should be a name that matches a enum from com.fasterxml.jackson.databind.SerializationFeature, com.fasterxml.jackson.databind.DeserializationFeature, or com.fasterxml.jackson.databind.MapperFeature Multiple features can be separated by comma |  | String
| *camel.dataformat.json-jackson.enable-jaxb-annotation-module* | Jackson を使用している場合に、JAXB アノテーションモジュールを有効にするか否かを指定する。有効な場合に JAXB アノテーションは Jackson で使用される。 | false | Boolean
| *camel.dataformat.json-jackson.enabled* | JSON-Jackson データフォーマットを有効にする。 | true | Boolean
| *camel.dataformat.json-jackson.include* | If you want to marshal a pojo to JSON, and the pojo has some fields with null values. And you want to skip these null values, you can set this option to NON_NULL |  | String
| *camel.dataformat.json-jackson.json-view* | POJO から JSON にマーシャリングする場合に、JSON 出力から特定のフィールドを除外したい場合がある。これを実現するために、Jackson の JSON ビューを使用できる。このオプションは、JsonView アノテーションを持つクラスを参照する。 |  | Class
| *camel.dataformat.json-jackson.library* | どの JSON ライブラリを使用するかを指定する。 |  | JsonLibrary
| *camel.dataformat.json-jackson.module-class-names* | To use custom Jackson modules com.fasterxml.jackson.databind.Module specified as a String with FQN class names. Multiple classes can be separated by comma. |  | String
| *camel.dataformat.json-jackson.module-refs* | To use custom Jackson modules referred from the Camel registry. Multiple modules can be separated by comma. |  | String
| *camel.dataformat.json-jackson.object-mapper* | Lookup and use the existing ObjectMapper with the given id when using Jackson. |  | String
| *camel.dataformat.json-jackson.permissions* | Adds permissions that controls which Java packages and classes XStream is allowed to use during unmarshal from xml/json to Java beans. A permission must be configured either here or globally using a JVM system property. The permission can be specified in a syntax where a plus sign is allow, and minus sign is deny. Wildcards is supported by using . as prefix. For example to allow com.foo and all subpackages then specfy com.foo.. Multiple permissions can be configured separated by comma, such as com.foo.,-com.foo.bar.MySecretBean. The following default permission is always included: -,java.lang.,java.util. unless its overridden by specifying a JVM system property with they key org.apache.camel.xstream.permissions. |  | String
| *camel.dataformat.json-jackson.pretty-print* | 読みやすく整列された出力にするか否かを指定する。デフォルトでは false である。 | false | Boolean
| *camel.dataformat.json-jackson.timezone* | マーシャリングもしくはアンマーシャリングのときに、Jackson が使用する Timezone を指定する。このオプションは、gson、fastjson、や xstream といった他の Json データフォーマットには影響は及ぼさない。 |  | String
| *camel.dataformat.json-jackson.unmarshal-type-name* | アンマーシャリングの場合に使用する Java の型名称を指定する。 |  | String
| *camel.dataformat.json-jackson.use-default-object-mapper* | レジストリからデフォルトの Jackson ObjectMapper を検索して使用するかを指定する。 | true | Boolean
| *camel.dataformat.json-jackson.use-list* | マップのリストまたは POJO のリストにアンマーシャルするかを指定する。 | false | Boolean
|===
// spring-boot-auto-configure options: END

=== カスタム ObjectMapper の使用

マッピングの設定をより詳しく行う場合は、`JacksonDataFormat` を設定して、カスタム `ObjectMapper` を使用できる。

レジストリ内に 1 つの `ObjectMapper` を設定した場合は、Camel は自動的に、この `ObjectMapper` を検索して使用する。
例えば、Spring Boot を使用し Spring MVC を有効にしている場合は、Spring Boot はデフォルトの `ObjectMapper` を提供している。
この場合は、Spring Boot Bean レジストリ内で `ObjectMapper` クラスの 1 つの Bean を Camel が検知して使用できることになる。
Camel のログレベルを `INFO` に設定すると、上記が発生した場合にログ出力される。


=== 依存性

Camel のルートで Jackson を使用するためには、データフォーマットを実装した *camel-jackson* 依存性を追加する必要がある。

Maven を使用している場合は、pom.xml に次の依存性を追加する。
バージョン番号は最新で一番最近のリリースに置き換えること
（最新バージョンについてはダウンロードページを参照すること）。


[source,xml]
----------------------------------------------------------
<dependency>
  <groupId>org.apache.camel</groupId>
  <artifactId>camel-jackson</artifactId>
  <version>x.x.x</version>
  <!-- Camel コアバージョンと同じバージョンを使うこと。 -->
</dependency>
----------------------------------------------------------
